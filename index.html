<!DOCTYPE html>
<html>
<head>
  <title>Prayer Clock</title>
  <style>
    #notification-panel {
      border: 1px solid #ccc;
      padding: 10px;
      margin-top: 20px;
    }

    .notification {
      margin-bottom: 10px;
    }

    .current-prayer {
      font-weight: bold;
      color: blue;
    }
  </style>
</head>
<body>
  <h1>Prayer Clock</h1>

  <div id="clock"></div>

  <div id="prayer-times">
    <h2>Tiempos de oración</h2>
    <label for="fajr-time">Fajr: </label>
    <input type="time" id="fajr-time" value="04:11">
    <br>
    <label for="dhuhr-time">Dhuhr: </label>
    <input type="time" id="dhuhr-time" value="11:52">
    <br>
    <label for="asr-time">Asr: </label>
    <input type="time" id="asr-time" value="15:19">
    <br>
    <label for="maghrib-time">Maghrib: </label>
    <input type="time" id="maghrib-time" value="18:16">
    <br>
    <label for="isha-time">Isha: </label>
    <input type="time" id="isha-time" value="19:29">
    <br>
    <button id="save-prayer-times">Guardar cambios</button>
  </div>

  <div id="livestream">
    <h2>Transmisión en vivo desde La Meca</h2>
    <div class="livestream-video">
      <iframe width="560" height="315" src="https://www.youtube.com/embed/hrnT2IFqyro" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
    </div>
  </div>

  <div id="notification-panel">
    <h2>Notificaciones</h2>
    <div class="notification-list" id="notification-list"></div>
  </div>

  <script>
    var prayerTimes = {
      fajr: { hour: 4, minute: 11 },
      dhuhr: { hour: 11, minute: 52 },
      asr: { hour: 15, minute: 19 },
      maghrib: { hour: 18, minute: 16 },
      isha: { hour: 19, minute: 29 }
    };

    function updateClock() {
      var clockElement = document.getElementById('clock');
      var currentTime = new Date();
      var hours = currentTime.getHours();
      var minutes = currentTime.getMinutes();
      var seconds = currentTime.getSeconds();

      var timeString = formatTime(hours) + ':' + formatTime(minutes) + ':' + formatTime(seconds);
      clockElement.textContent = timeString;
    }

    function formatTime(time) {
      return time < 10 ? '0' + time : time;
    }

    function updatePrayerTimes() {
      var currentPrayer = null;
      var currentTime = new Date();
      var currentHour = currentTime.getHours();
      var currentMinute = currentTime.getMinutes();

      for (var prayer in prayerTimes) {
        var prayerElement = document.getElementById(prayer + '-time');
        var hour = prayerTimes[prayer].hour;
        var minute = prayerTimes[prayer].minute;

        var formattedHour = formatTime(hour);
        var formattedMinute = formatTime(minute);

        prayerElement.textContent = formattedHour + ':' + formattedMinute;

        if (currentHour === hour && currentMinute === minute) {
          currentPrayer = prayer;
          prayerElement.classList.add('current-prayer');
        } else {
          prayerElement.classList.remove('current-prayer');
        }
      }

      if (currentPrayer && !isNotificationShown()) {
        showNotification('Es hora de rezar ' + currentPrayer);
        markNotificationShown();
        playAlarmSound();
      }
    }

    function showNotification(message) {
      var notificationList = document.getElementById('notification-list');
      var notificationItem = document.createElement('div');
      notificationItem.classList.add('notification');
      notificationItem.textContent = message;
      notificationList.appendChild(notificationItem);
    }

    function requestNotificationPermission() {
      if ('Notification' in window) {
        Notification.requestPermission();
      }
    }

    function isNotificationShown() {
      return localStorage.getItem('notificationShown') === 'true';
    }

    function markNotificationShown() {
      localStorage.setItem('notificationShown', 'true');
    }

    function playAlarmSound() {
      var audio = new Audio('alarm.mp3');
      audio.play();
    }

    function savePrayerTimes() {
      var fajrTime = document.getElementById('fajr-time').value;
      var dhuhrTime = document.getElementById('dhuhr-time').value;
      var asrTime = document.getElementById('asr-time').value;
      var maghribTime = document.getElementById('maghrib-time').value;
      var ishaTime = document.getElementById('isha-time').value;

      prayerTimes.fajr = { hour: parseInt(fajrTime.split(':')[0]), minute: parseInt(fajrTime.split(':')[1]) };
      prayerTimes.dhuhr = { hour: parseInt(dhuhrTime.split(':')[0]), minute: parseInt(dhuhrTime.split(':')[1]) };
      prayerTimes.asr = { hour: parseInt(asrTime.split(':')[0]), minute: parseInt(asrTime.split(':')[1]) };
      prayerTimes.maghrib = { hour: parseInt(maghribTime.split(':')[0]), minute: parseInt(maghribTime.split(':')[1]) };
      prayerTimes.isha = { hour: parseInt(ishaTime.split(':')[0]), minute: parseInt(ishaTime.split(':')[1]) };

      updatePrayerTimes();
    }

    setInterval(updateClock, 1000);
    setInterval(updatePrayerTimes, 1000);

    document.getElementById('save-prayer-times').addEventListener('click', savePrayerTimes);

    // Request notification permission
    requestNotificationPermission();
  </script>
</body>
</html>
